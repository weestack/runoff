# First the different message types are defined
# in the special 'message' block. Messages can contain
# data such as the ping example which contains an int
pinid pin1 = 1P;
pinid pin123 = 94P;
pinid pin9 = 23P;

messages {
	Ping{taskid i};
	Pong;
}

task pong() {
	for(;;) {
		receive {
		case Ping{pingtaskid}: send Pong{} to pingtaskid;
		default:
		}
	}
}

task ping(taskid pongtaskid) {
	taskid last = spawn pong();
	msg pingmsg = Ping{last}; # the msg type can contain any of the messages

	for(;;){
		# a ping message is sent to the pong task
		send pingmsg to last;
		receive {
		case Pong{}: delay(1);
		default:
		}
	}
}

function setup() -> void {
	taskid pongtaskid = spawn pong();
	taskid pingtaskid = spawn ping(pongtaskid);
}
